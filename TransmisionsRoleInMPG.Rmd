---
title: "Automatic vs Manual Transmisson for better MPG"
author: "Sarah Massengill"
date: "2/19/2021"
output: pdf_document
---

# Executive Summary

"Is an automatic or manual transmission better for MPG‚Äù

"Quantify the MPG difference between automatic and manual transmissions"

# Exploratory Analysis and Model Search 

```{r, explore, echo=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
library(corrplot)


mtcars2<- mtcars %>%
          mutate(am=factor(am, levels=c(0,1),labels = c("auto", "man")),
                 cyl = factor(cyl), 
                 vs = factor(vs),
                 gear = factor(gear),
                 carb = factor(carb),
                 wt.cat = cut(wt,
                              breaks = c(0,3,6),
                              right=FALSE)) %>%
        
          group_by(am)

```

Looking t-test first.  
H_0: There is no difference in the mean MPG for an automatic and manual transmission.  
H_A: There is a difference in the mean MPG for an automatic and manual transmission.

By creating two subgroups in the data, ones who transmission type (am) is automatic ("auto") versus manual("man") a t.test can be used to test the null hypothesis. R's t.test function calculates the 95% confidence interval of the difference between the two groups' means to be on average between 3.6 and 10.8 miles per gallon less for vehicles with automatic transmissions. The differences in the mean is significant with a p-value equal to 0.00285. The null hypothesis is rejected in favor of the alternative hypothesis.   

Modeling MPG with Transmission Type (am) alone:

Model 1: $mpg = b_0 + b_1(am)$
         $mpg = 17.1 + 7.2(am)$

The t-test results are mirrored in the simple linear model that predicts mpg based on type of transmission (am: auto = 0,man = 1).  On average, switching from an automatic to a manual transmission increases the mean miles per gallon by 7.2 mpg on average, with a 95% confidence interval of [3.64,10.84]. Since zero is *not* in the interval for $b_1$ we could conclude that there is a statistically significant difference in MPG for automatic and manual transmissions. Unfortunately, based on the $R^2$ statistic this linear model only describes about 36% of the variation in MPG results.  If this model described more of the variation in the results we could stop here, but there are probably confounding and/or interaction variables that are causing some of the variance and hiding the true effects of transmission on the MPG of the vehicles in the data set.

It is interesting to note that this simple linear model appears to satisfy the assumptions of linearity, constant variance and normally distributed residuals even if it does not quite answer if an automatic transmission is better than a manual transmission, but it eludes to manual transmission being better.  
  
```{r,t-tests & linear regression, results='hide',echo=FALSE, message=FALSE}
#str(mtcars2)

# two sided t-test to see if there is a significant difference in the mean mpg for 
# Automatic vs manual transmission. The null hypothesis is that there is no difference
# between the means.  With a p-value of 0.000285 < 0.05 the null hypothesis can be rejected in 
# favor of the alternative hypothesis that there is a difference in the mean mpg for Automatic
# Vs manual transmission.  The 95% confidence interval puts the difference on the interval
# [-10.8 -3.6], with zero not in the interval, the 95% confidence interval agrees with the 
# p-value as expected.  The sample means were estimated to be 17.1mpg for an automatic and 
# 24.4 for a manual transmission. 

t.test(mtcars2$mpg[mtcars2$am=="auto"],mtcars2$mpg[mtcars2$am=="man"], alt="two.sided")
lm.am <- lm(mpg~am,mtcars2)
summary(lm.am)
confint(lm.am)

```
Moving to a multivariable regression:

Does Weight (wt) confound and/or interact the effects of the Transmission (am) on MPG?  

After plotting the MPG with respect to weight (wt) and differentiating by color the manual and automatic transmissions show a relationship to weight.  The lighter weight vehicles in the data set are mostly manual while the heavier vehicles are automatic. The weight of the vehicle is also linearly related with MPG in that the heavier vehicles correlate to less MPG and vice verse. There are 18 automatic transmission vehicles over three metric tones and one below, while two manual transmission vehicle over and 11 under. This split makes it difficult to separate the effects of each from each other without an interaction term.


## Introducing two new multivariable linear models:  
### model 2: $mpg = b_0 + b_1(am) + b_2(wt)$

### model 3: $mpg = b_0 + b_1(am) + b_2(wt)+ b_3(am)(wt)$

The first of the two models estimates the average effects of transmission on the mileage while holding the weight constant. The second model does the same thing but also adds an effect modifier term.  

- $b_0$: average MPG for a automatic transmission (am = "auto") when the weight of the vehicle (wt) is zero  
- $b_1$ average change in MPG when switching from an automatic transmission to a manual(am="man") controlling for weight (wt = constant)  
- $b_2$ average change in MPG with a 1-metric ton increase in the weight (wt) of the vehicle controlling for transmission type.
- $b_3$ effect modifier in the second model, this effect modifier will alter the effect of the manual transmission on mpg based on the weight. 

Graphically, the first model will have the same slope but the y intercepts change if $b_1$ is non-zero, the second model allows for a different slope and a different intercept between the two lines that represent the transmission groups.        

Results:

model 2: 
$mpg =
  \begin{cases}
   37.32 -5.4(wt) & \text{if $am = auto$} \\
  \ 37.32 - .02(1) -5.4(wt) & \text{if $am = man$} \\
  \end{cases}$
model 3: 
$mpg =
  \begin{cases}
   31.4 -5.4 \cdot wt & \text{if $am = auto$} \\
  \ 37.34 + 14.9(1) -5.4\cdot wt & \text{if $am = man$} \\
  \end{cases}$


## Exploratory analysis

[, 1]	mpg	Miles/(US) gallon
[, 2]	cyl	Number of cylinders
[, 3]	disp	Displacement (cu.in.)
[, 4]	hp	Gross horsepower
[, 5]	drat	Rear axle ratio
[, 6]	wt	Weight (1000 lbs)
[, 7]	qsec	1/4 mile time
[, 8]	vs	Engine (0 = V-shaped, 1 = straight)
[, 9]	am	Transmission (0 = automatic, 1 = manual)
[,10]	gear	Number of forward gears
[,11]	carb	Number of carburetors



```{r}
lm.am.wt1<-lm(mpg~am + wt,data = mtcars2)
lm.am.wt2<-lm(mpg~am*wt,data=mtcars2)
summary(lm.am.wt1)
intm1.1 = coef(lm.am.wt1)[1]
slopem1=coef(lm.am.wt1)[3]
intm1.2 = sum(coef(lm.am.wt1)[1:3])
summary(lm.am.wt2)

# M<-cor(mtcars)
# corrplot(M, method="number")
## plot
table(mtcars2$am,mtcars2$wt.cat)

```
## Appendix
### Model 1 Plots
```{r plotsm1, echo=FALSE}
## Simple Linear Model: Model 1

par(mfrow=c(2,2))
ggplot(mtcars2,aes(x=am,y=mpg,color = am))+geom_point()
plot(lm.am)
```

### Model 2 & 3 plots

```{r,m2, echo=FALSE}
g <- ggplot(data=mtcars2,aes(x=am, y=mpg, fill=am)) +
        facet_wrap(mtcars2$wt.cat~., scales = "fixed")+geom_boxplot()
     #geom_boxplot()+geom_hline(yintercept=mean(mtcars2$mpg),color="red") #+
     # facet_grid(~dose,
     #            labeller = labeller(dose=dose.labs)) +
     # labs(y = "Tooth Growth", 
     #      x = "Supplement", 
     #      title = "Effect of Vitamin C on Guinea Pig Tooth Growth by Dose and Supplement") +
     # scale_fill_discrete(labels = supp.labs) +
     # theme(
     #         legend.position = "none",
     #         legend.direction = "horizontal",
     #         legend.title = element_blank()
     #)
g
wt1<-ggplot(data=mtcars2,aes(x = wt,y=mpg,color=am ))+geom_point() + 
        #geom_smooth(method="lm")+
        # geom_hline(yintercept=mean(mtcars2$mpg),color="red")+
        # geom_hline(yintercept=mean(mtcars2$mpg[mtcars2$am=="man"]),color="lightblue",linetype=2)+
        # geom_hline(yintercept=mean(mtcars2$mpg[mtcars2$am=="auto"]),color="salmon",linetype=2)+
        # geom_segment(x=2.8,y=0,xend=2.8,yend=20.8,linetype=2,color="black")+
        geom_abline(intercept=coef(lm.am.wt1)[1],slope=coef(lm.am.wt1)[3],color="salmon",size=1) +
        geom_abline(intercept=sum(coef(lm.am.wt1)[1:2]),slope=coef(lm.am.wt1)[3],color="blue",size=1)


wt1
```
## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
